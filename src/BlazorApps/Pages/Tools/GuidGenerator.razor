@page "/tools/guid"
@using System.Text
@inject IJSRuntime JSRuntime

<PageTitle>GUID Generator</PageTitle>

<h1>GUID Generator</h1>

<p>Generate unique identifiers (GUIDs) in various formats.</p>

<FluentStack Orientation="Orientation.Vertical" VerticalGap="20">
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="15">
            <FluentNumberField @bind-Value="count" Min="1" Max="128" Label="Number of GUIDs to generate" />

            <FluentLabel>GUID Format</FluentLabel>
            <FluentRadioGroup @bind-Value="format" Name="guidFormat" Orientation="Orientation.Vertical">
                <FluentRadio Value="@("D")">D (Default) - xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</FluentRadio>
                <FluentRadio Value="@("N")">N - xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</FluentRadio>
                <FluentRadio Value="@("B")">B - {xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}</FluentRadio>
                <FluentRadio Value="@("P")">P - (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)</FluentRadio>
                <FluentRadio Value="@("X")">X - {0x00000000,0x0000,0x0000,{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}}</FluentRadio>
            </FluentRadioGroup>

            <FluentLabel>Case</FluentLabel>
            <FluentRadioGroup @bind-Value="casing" Name="guidCasing" Orientation="Orientation.Horizontal">
                <FluentRadio Value="@("Lower")">Lowercase</FluentRadio>
                <FluentRadio Value="@("Upper")">UPPERCASE</FluentRadio>
            </FluentRadioGroup>

            <FluentStack Orientation="Orientation.Horizontal" VerticalGap="10">
                <FluentButton Appearance="Appearance.Accent" OnClick="GenerateGuids">Generate GUID</FluentButton>
                @if (guids.Any())
                {
                    <FluentButton Appearance="Appearance.Neutral" OnClick="CopyToClipboard" IconStart="@(new Icons.Regular.Size16.Copy())">Copy</FluentButton>
                }
            </FluentStack>
            
        </FluentStack>
    </FluentCard>

    @if (guids.Any())
    {
        <FluentTextArea Value="@FormattedOutput" ReadOnly="true" Rows="@(Math.Min(count + 2, 20))" Style="width: 100%; font-family: monospace;" />
    }
</FluentStack>

@code {
    private int count = 1;
    private string format = "D";
    private string casing = "Lower";
    private List<Guid> guids = new();

    private string FormattedOutput
    {
        get
        {
            if (!guids.Any()) return string.Empty;

            var sb = new StringBuilder();
            foreach (var guid in guids)
            {
                string result = guid.ToString(format);
                if (casing == "Upper")
                {
                    result = result.ToUpper();
                }
                else
                {
                    result = result.ToLower();
                }
                sb.AppendLine(result);
            }
            return sb.ToString();
        }
    }

    private void GenerateGuids()
    {
        // Enforce limits
        if (count < 1) count = 1;
        if (count > 128) count = 128;

        guids.Clear();
        for (int i = 0; i < count; i++)
        {
            guids.Add(Guid.NewGuid());
        }
    }

    private async Task CopyToClipboard()
    {
        if (!string.IsNullOrEmpty(FormattedOutput))
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", FormattedOutput);
            // Optional: Provide feedback to the user (e.g., toast notification) if desired, 
            // but requirements just asked for the button.
        }
    }
}
